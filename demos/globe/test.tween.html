<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      body {
        background: #000 url(loading.gif) center center no-repeat;
        font-family: sans-serif;
        color: #fff;
      }
    </style>
  </head>

  <body>
  <div id="container"></div>

  <script type="text/javascript" src="third-party/Three/ThreeWebGL.js"></script>
  <script type="text/javascript" src="third-party/Three/ThreeExtras.js"></script>
  <script type="text/javascript" src="third-party/Three/RequestAnimationFrame.js"></script>
  <script type="text/javascript" src="third-party/Three/Detector.js"></script>
  <script type="text/javascript" src="third-party/Tween.js"></script>
  <script type="text/javascript" src="globe.js"></script>

  <script type="text/javascript">

  if (!Detector.webgl) {
    Detector.addGetWebGLMessage();
  } else {
    var container = document.getElementById('container');
    var globe = new DAT.Globe(container);
    console.log(globe);
    var tweens = [];
    TWEEN.start();

    var stage = {
      x: Math.PI * 3 / 2,
      y: Math.PI / 6.0,
      distance: 50000,
      dwell : 5000,

      last : function() {
        console.log('last');
        new TWEEN.Tween(stage).delay(2000).onComplete(stage.start).start();
        stage.dwell = 1000 + Math.random() * 3000;
      },

      right : function() {
        console.log('right');
        var lat = -33 / 180 * Math.PI;
        var lon = 151.559 / 180 * Math.PI - Math.PI / 2;
        new TWEEN.Tween(stage).delay(2000).to({x: lon, y: lat, distance: 900}, 2000).easing(TWEEN.Easing.Cubic.EaseOut).onComplete(stage.last).start();
      },

      left : function() {
        console.log('left');
        var lat = 47 / 180 * Math.PI;
        var lon = -122 / 180 * Math.PI - Math.PI / 2;
        new TWEEN.Tween(stage).delay(2000).to({x: lon, y: lat, distance: 700}, 2000).easing(TWEEN.Easing.Cubic.EaseOut).onComplete(stage.right).start();
      },

      next : function() {
        console.log('next');
        var lat = 54 / 180 * Math.PI;
        var lon = -0.137 / 180 * Math.PI - Math.PI / 2;
        rotationTween.stop();
        new TWEEN.Tween(stage).delay(500).to({x: lon, y: lat, distance: 500}, 2000).easing(TWEEN.Easing.Cubic.EaseOut).onComplete(stage.left).start();
      },

      start : function() {
        console.log('start');
        rotationTween = new TWEEN.Tween(stage).to({x: -Math.PI * 5}, stage.dwell + 2000).start();
        new TWEEN.Tween(stage).to({distance: 1000}, stage.dwell).easing(TWEEN.Easing.Cubic.EaseOut).onComplete(stage.next).start();
      },
    };

    var rotationTween = null;
    globe.animate();
    stage.start();
  }
  </script>
  </body>
</html>
